import"./open-interstitial-modal-b8fed0ec.js";import"./confirm-over-18-6483fc66.js";import{z as t,A as e,i,f as s,_ as o,n,t as r,s as a,c as l,cQ as c,cR as p,x as d,g as h,h as m,e as f}from"./shell-87f4060d.js";import"./index-ab530205.js";import"./reddit-page-data-dbcf1868.js";import"./shreddit-comments-page-ad-9b17a589.js";import"./shreddit-tweet-embed-abf1d8e8.js";import"./icon-caret-left-1b9c5e87.js";import"./icon-caret-right-443c6e35.js";import"./faceplate-tabgroup-2955dea5.js";import"./faceplate-tabpanel-76bbb42e.js";import"./shreddit-search-5f594b70.js";import"./shreddit-lead-generation-ad-dialog-19f34419.js";import"./comment-body-header-825139a9.js";import"./shreddit-join-link-7f65e82a.js";import"./guard-community-modal-6b99284a.js";import"./shreddit-subreddit-header-8c03bd37.js";import"./ref-49656557.js";import"./icon-play-09a8adab.js";import"./faceplate-tablist-1c19767e.js";import"./pageable-832f4cce.js";import"./icon-caret-right-outline-fa171d46.js";import"./icon-search-94b40593.js";import"./search-helpers-4cf7fbc4.js";import"./faceplate-bottom-sheet-1eb0e782.js";import"./TinyGesture-fec3f2ea.js";import"./faceplate-bottom-sheet-header-4e8d28b0.js";import"./faceplate-text-input-77bbc8a5.js";import"./faceplate-checkbox-input-bdde7cb1.js";import"./checked-input-element-94886ae5.js";import"./comment-composer-host-f2fb3c57.js";import"./types-52bb0d93.js";import"./composer-bc689e00.js";import"./faceplate-progress-42167ff8.js";import"./telemetry-event-struct-d8880359.js";import"./commentsPage-5805edd3.js";import"./icon-new-02ebdaf1.js";import"./icon-archived-772ed1ab.js";import"./icon-privacy-outline-2c7d1bad.js";import"./theme-05d8ff74.js";import"./feeds-a4ae64dc.js";import"./icon-warning-fill-54537c7e.js";import"./index-9f21b6e5.js";import"./icon-notification-fill-b42b0d5b.js";import"./icon-notification-off-outline-425756a2.js";import"./icon-notification-outline-a4f48663.js";import"./icon-overflow-horizontal-outline-2644819f.js";const{svg:u}=t();var b=e(u`<path d="M17.375 2H2.625A2.629 2.629 0 0 0 0 4.625v10.75A2.63 2.63 0 0 0 2.625 18h14.75A2.63 2.63 0 0 0 20 15.375V4.625A2.63 2.63 0 0 0 17.375 2Zm1.375 13.375a1.377 1.377 0 0 1-1.375 1.375H2.625a1.377 1.377 0 0 1-1.375-1.375V4.625A1.377 1.377 0 0 1 2.625 3.25h14.75a1.377 1.377 0 0 1 1.375 1.375v10.75Zm-2.2-5.7.029.589-.212.254-2.929 2.929-.884-.884L15.116 10l-2.558-2.558.884-.884 3.108 3.117ZM7.442 7.442 4.884 10l2.558 2.558-.884.884-3.112-3.112-.029-.589.212-.254 2.929-2.929.884.884ZM9.375 6h1.25v8h-1.25V6Z"></path>`,"0 0 20 20","embed-outline");const g=t=>t.replace(/\n/g,"").replace(/\s+/g," ").trim(),j=({commentId:t,noPrefix:e})=>{let i=t.replace("-comment-rtjson-content","");return e&&(i=i.replace("t1_","")),i},T=({commentId:t,permalink:e,snippetData:i})=>t?`https://publish.reddit.com/embed?url=https://www.reddit.com${e.replace(/\/[^/]+(?=\/$)|\/$/,"")}comment/${j({commentId:t,noPrefix:!0})}?snippet=${i}`:`https://publish.reddit.com/embed?url=https://www.reddit.com${e}?snippet=${i}`,x=["TR","TH","TD","TABLE","TBODY","THEAD"];let v=class extends a{constructor(){super(...arguments),this.titleHeight=0,this.postId="",this.permalink="",this.topOffset=0,this.leftOffset=0,this.snippetData="",this.isTitleSelected=!1,this.isSelectionOutOfRange=!1,this.isFullTextSelected=!1,this.isComment=!1,this.clearSelection=t=>{if(2!==t.button&&t.target.getAttribute("postid")!==this.postId){const e=((t,e)=>{for(;t;){if(t.id&&(t.id.includes(`${e}-post-rtjson-content`)||t.id.includes("-comment-rtjson-content")))return t;t=t.parentNode}return null})(t.target,this.postId);this.richTextContainer=e,getSelection()?.empty(),this.snippetData="",this.isTitleSelected=!1,this.isSelectionOutOfRange=!1,this.isFullTextSelected=!1}},this.handleEmbedClick=()=>{this.isComment&&this.richTextContainer?.id?open(T({commentId:this.richTextContainer?.id,permalink:this.permalink,snippetData:this.snippetData}),"RedditEmbed"):open(T({permalink:this.permalink,snippetData:this.snippetData}),"RedditEmbed"),this.sendClickTelemetry()},this.calculateSnippetData=t=>{if(this.shouldShowButton)return void this.clearSelection(t);this.isComment=Boolean(this.richTextContainer?.id&&this.richTextContainer.id.startsWith("t1")),this.snippetData="";const e=getSelection(),i=g(e?.toString()||"");if(!e||!i?.length)return;const s=this.richTextContainer?g(this.richTextContainer.innerText):"",o=g(this.postTitleElement.innerText);this.richTextContainer&&i===s&&(this.isFullTextSelected=!0);const n=e?.anchorNode;if(n.parentNode?.nodeName&&x.includes(n.parentNode?.nodeName))return;const r=e.getRangeAt(0);n.parentNode===this.postTitleElement&&(this.isTitleSelected=!0),(this.isTitleSelected&&i.length>o.length||this.richTextContainer&&i.length>s.length)&&(this.isSelectionOutOfRange=!0);const a=this.isTitleSelected?this.postTitleElement?.getBoundingClientRect():this.richTextContainer?.getBoundingClientRect(),l=e?.getRangeAt(0).getBoundingClientRect();if(a&&l){if(this.topOffset=l.top+scrollY,this.leftOffset=l.left+l.width/2,this.shadowRoot?.host.style.setProperty("--left-offset",`${this.leftOffset}px`),this.shadowRoot?.host.style.setProperty("--top-offset",this.topOffset-32-4+"px"),this.isTitleSelected||this.isFullTextSelected)return void this.sendViewTelemetry();if(e.rangeCount>0){let t=-1;const e=Array.from((this.isComment?this.richTextContainer?.children[0].children:this.richTextContainer?.children)||[]).filter((t=>"#text"!==t.nodeName));for(let i=0;i<e.length;i++){const s=e[i];if(r.intersectsNode(s)){t=i;break}}if(-1!==t&&i){const s=(({nodeText:t,selectedText:e})=>{if(!t||!e)return-1;const i=t.length,s=e.length,o=[];for(let t=0;t<=i;t++)o[t]=new Array(s+1).fill(0);let n=0,r=0;for(let a=1;a<=i;a++)for(let i=1;i<=s;i++)t[a-1]===e[i-1]&&(o[a][i]=o[a-1][i-1]+1,o[a][i]>n&&(n=o[a][i],r=a-1));const a=t.substring(r-n+1,r+1);return a?t.indexOf(a):-1})({nodeText:g(e[t].innerText),selectedText:i});t>-1&&s>-1&&i.length>0&&(this.snippetData=`${t}_${s}_${i.length}`,this.sendViewTelemetry())}}}},this.getEventDetails=()=>{const t={};return this.isComment&&this.richTextContainer?.id&&(t.comment={id:j({commentId:this.richTextContainer.id})}),t},this.sendViewTelemetry=()=>{const t=this.getEventDetails();this.dispatchEvent(l(c,{details:t}))},this.sendClickTelemetry=()=>{const t=this.getEventDetails();this.dispatchEvent(l(p,{details:t}))}}get shouldShowButton(){return(this.snippetData.length||this.isTitleSelected||this.isFullTextSelected)&&!this.isSelectionOutOfRange}connectedCallback(){super.connectedCallback();const t=document.getElementById(`post-title-${this.postId}`);t&&(this.postTitleElement=t,this.titleHeight=this.postTitleElement.clientHeight),document.addEventListener("mousedown",this.clearSelection),document.addEventListener("mouseup",this.calculateSnippetData)}disconnectedCallback(){super.disconnectedCallback(),document.removeEventListener("mousedown",this.clearSelection),document.removeEventListener("mouseup",this.calculateSnippetData)}render(){return d`\n ${this.shouldShowButton?d`\n <div class="button-container bg-neutral-content-strong rounded-full shadow-sm flex">\n ${h({appearance:"plainInverted",size:m.Small,attributes:{onclick:this.handleEmbedClick},leadingIcon:b(),children:"Embed"})}\n </div>\n `:""}\n `}};v.styles=[i`.button-container{position:absolute;left:var(--left-offset);top:var(--top-offset);transform:translateX(-50%);z-index:1}`,s],o([n({type:String})],v.prototype,"postId",void 0),o([n({type:String})],v.prototype,"permalink",void 0),o([r()],v.prototype,"topOffset",void 0),o([r()],v.prototype,"leftOffset",void 0),o([r()],v.prototype,"snippetData",void 0),o([r()],v.prototype,"isTitleSelected",void 0),o([r()],v.prototype,"isSelectionOutOfRange",void 0),o([r()],v.prototype,"isFullTextSelected",void 0),o([r()],v.prototype,"isComment",void 0),v=o([f("embed-snippet-share-button")],v);let S=class extends a{static get styles(){return i`:host{display:block;position:relative}`}render(){return d`\n <slot></slot>\n <slot name="link"></slot>\n `}};S=o([f("post-media-container")],S),import("./faceplate-hovercard-b8bf1271.js"),import("./faceplate-progress-42167ff8.js"),import("./faceplate-tooltip-f1238739.js");
//# sourceMappingURL=pdp-client-js-a585c889.js.map
