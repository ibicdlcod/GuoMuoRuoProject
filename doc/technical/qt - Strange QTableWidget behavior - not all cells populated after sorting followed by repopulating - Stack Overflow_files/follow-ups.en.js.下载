(()=>{"use strict";var t={p:""};t.p=document.getElementById("webpack-public-path").innerText+"Js/",(()=>{function t(t,e,o=void 0,n=void 0){const r=new FormData;r.append("fKey",null!=n?n:StackExchange.options.user.fkey),r.append("data",JSON.stringify(e)),r.append("event",t);let s={};o&&(s["X-Previous-Event-Id"]=o),fetch((StackExchange.options.site.routePrefix||"")+"/stackevent",{method:"POST",keepalive:!0,body:r,headers:s}).then((()=>{}))}var e,o;const n=600,r=(null===(e=document.getElementById("js-follow-ups-experiment-group"))||void 0===e?void 0:e.getAttribute("data-value"))||"test",s=(null===(o=document.getElementById("js-follow-ups-experiment-group"))||void 0===o?void 0:o.getAttribute("data-site-url"))||"",a=(t,e)=>{t.querySelectorAll(e.join(", ")).forEach((t=>{t.classList.toggle("d-none")}))},l=t=>{var e;if(t&&!t.classList.contains("d-none"))null===(e=t.querySelector("textarea"))||void 0===e||e.focus();else{const e=t.querySelector("textarea");e&&(e.value="")}};async function c(e,o,n,a,l){var c;e.preventDefault();const i=o.getAttribute("data-post-id");null==n||n.classList.add("is-loading");let d,m=!1;const p=parseInt((null===(c=document.querySelector(".js-question"))||void 0===c?void 0:c.getAttribute("data-questionid"))||"0"),f=parseInt(i||"0"),y=parseInt(o.getAttribute("data-total-comment-count")||"0"),w=[...document.querySelectorAll(".js-follow-ups-container")].indexOf(o);try{const t=new FormData;t.append("comment",a.value),t.append("fkey",StackExchange.options.user.fkey);const e=await fetch(`${s}/posts/${i}/comments`,{method:"POST",body:t});if(!e.ok){const t=await e.text()||__tr(["An error occurred while attempting to submit your comment"], undefined, "en", []);throw new Error(t)}{m=!0;const t=await e.text(),n=new DOMParser,r=n.parseFromString(t,"text/html").querySelectorAll(".js-comment");d=parseInt(r[r.length-1].getAttribute("data-comment-id")||"0"),await u(o,{topCommentsOnly:!1,scrollToContainerEnd:l})}}catch(t){null==n||n.classList.remove("is-loading");let e=__tr(["An error occurred during edit submit."], undefined, "en", []);t instanceof Error&&t.message&&(e=t.message),StackExchange.helpers.showToast(e,{type:"danger"})}t("follow_ups_ui_experiment.comment.submit",{source:window.location.href,submitSuccess:m,questionId:p,answerId:f,commentId:d,numberOfPreExistingComments:y,answerPositionOnPage:w,followUpsUIExperimentGroup:r})}async function i(t,e,o,n){var r,a;t.preventDefault();const l=e.querySelector(`.js-follow-up[data-follow-up-id="${o}"]`),c=null===(a=null===(r=l.querySelector(".edit-comment-form .js-comment-body"))||void 0===r?void 0:r.textContent)||void 0===a?void 0:a.trim();if(c){if(n.value.trim()===c)return void StackExchange.helpers.showToast(__tr(["No changes were made to the comment!"], undefined, "en", []),{type:"danger"})}const i=l.querySelector(".js-edit-comment-submit");null==i||i.classList.add("is-loading");const d=l.getAttribute("data-reply-to-user-name"),m=new FormData;m.append("fkey",StackExchange.options.user.fkey),m.append("comment",v(n,d));try{const t=await fetch(`${s}/posts/comments/${o}/edit`,{method:"POST",body:m});if(!t.ok){const e=await t.text()||__tr(["An error occurred during edit submit."], undefined, "en", []);throw new Error(e)}await u(e)}catch(t){null==i||i.classList.remove("is-loading");let e=__tr(["An error occurred during edit submit."], undefined, "en", []);t instanceof Error&&t.message&&(e=t.message),StackExchange.helpers.showToast(e,{type:"danger",useRawHtml:!0})}}async function d(e,o,n,a,l){var c;e.preventDefault();const i=o.getAttribute("data-post-id"),d=n.querySelector(".js-reply-to-comment-submit");null==d||d.classList.add("is-loading");let m,p=!1;const f=parseInt((null===(c=document.querySelector(".js-question"))||void 0===c?void 0:c.getAttribute("data-questionid"))||"0"),y=parseInt(i||"0"),w=parseInt(o.getAttribute("data-total-comment-count")||"0"),h=[...document.querySelectorAll(".js-follow-ups-container")].indexOf(o),g=a.closest(".js-follow-up"),b=null==g?void 0:g.getAttribute("data-user-name");try{const t=new FormData;t.append("comment",v(a,b)),t.append("parentCommentId",l),t.append("fkey",StackExchange.options.user.fkey);const e=await fetch(`${s}/posts/${i}/comments`,{method:"POST",body:t});if(!e.ok){const t=await e.text()||__tr(["An error occurred while attempting to submit your comment"], undefined, "en", []);throw new Error(t)}{p=!0;const t=await e.text(),n=new DOMParser,r=n.parseFromString(t,"text/html").querySelectorAll(".js-comment");m=parseInt(r[r.length-1].getAttribute("data-comment-id")||"0"),await u(o,{topCommentsOnly:!1})}}catch(t){null==d||d.classList.remove("is-loading");let e=__tr(["An error occurred during edit submit."], undefined, "en", []);t instanceof Error&&t.message&&(e=t.message),StackExchange.helpers.showToast(e,{type:"danger"})}t("follow_ups_ui_experiment.comment.submit",{source:window.location.href,submitSuccess:p,questionId:f,answerId:y,commentId:m,numberOfPreExistingComments:w,answerPositionOnPage:h,followUpsUIExperimentGroup:r})}async function u(t,e={}){var o,n;if(t){const r=null!==(o=null==e?void 0:e.topCommentsOnly)&&void 0!==o?o:"True"===t.getAttribute("data-top-comments-only"),a=null!==(n=null==e?void 0:e.includeDeleted)&&void 0!==n?n:"True"===t.getAttribute("data-include-deleted"),l=t.getAttribute("data-post-id"),c=await fetch(`${s}/posts/${l}/follow-ups`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({topCommentsOnly:r,includeDeleted:a})}),i=await c.text(),d=t.parentElement;if(d){d.innerHTML=i;const t=d.firstElementChild;t&&b([t]);const o=d.querySelectorAll(".js-follow-up");if(e.scrollToContainerEnd&&o.length>5){const t=o[o.length-2];setTimeout((()=>{t.scrollIntoView({behavior:"smooth",block:"start"})}),0)}}}}const m=(t,e,o,r)=>{const s=t.querySelector(e),a=t.querySelector(o),l=t.querySelector(r);s&&a&&l&&(null==s||s.addEventListener("input",(t=>((t,e,o)=>{const r=t.target.value.trim().split(/\s+/).filter((t=>!t.startsWith("@"))).join(" ").length;let s="";e.classList.remove("fc-red-400","supernova"),r<15?(s=0===r?"Enter at least 15 characters":15-r+" more to go...",o.disabled=!0):r>n?(s=`Too long by ${r-n} characters`,e.classList.add("fc-red-400"),o.disabled=!0):(o.disabled=!1,n-r<=50&&(s=n-r+" characters left",e.classList.add("supernova"))),""!==s?(e.textContent=s,e.style.display="inline"):e.style.display="none"})(t,a,l))))},p=t=>{t.querySelectorAll(".js-follow-up-delete").forEach((e=>e.addEventListener("click",(o=>(async(t,e,o)=>{t.preventDefault();const n=o.closest(".js-follow-up"),r=null==n?void 0:n.getAttribute("data-follow-up-id"),a=new FormData;a.append("fkey",StackExchange.options.user.fkey),o.classList.add("is-loading");try{const t=await fetch(`${s}/posts/comments/${r}/vote/10`,{method:"POST",body:a});if(!t.ok){const e=await t.text()||__tr(["An error occurred while attempting to delete your comment"], undefined, "en", []);throw new Error(e)}await u(e)}catch(t){o.classList.remove("is-loading"),StackExchange.helpers.showToast(__tr(["An error occurred while attempting to delete your comment"], undefined, "en", []),{type:"danger"})}})(o,t,e)))))},f=t=>{t.querySelectorAll(".js-follow-up-undelete").forEach((e=>e.addEventListener("click",(o=>(async(t,e,o)=>{t.preventDefault();const n=e.getAttribute("data-post-id"),r=o.closest(".js-follow-up"),a=null==r?void 0:r.getAttribute("data-follow-up-id"),l=new FormData;l.append("fkey",StackExchange.options.user.fkey),o.classList.add("is-loading");try{(new FormData).append("fkey",StackExchange.options.user.fkey);const t=await fetch(`${s}/admin/posts/${n}/comments/${a}/undelete`,{method:"POST",body:l});if(!t.ok){const e=await t.text()||__tr(["An error occurred while attempting to undelete your comment"], undefined, "en", []);throw new Error(e)}await u(e)}catch(t){o.classList.remove("is-loading"),StackExchange.helpers.showToast(__tr(["An error occurred while attempting to undelete your comment"], undefined, "en", []),{type:"danger"})}})(o,t,e)))))},y=e=>{e.querySelectorAll(".js-vote-button").forEach((o=>{o.classList.contains("is-disabled")?o.addEventListener("click",(n=>{var s,a;n.preventDefault();const l=parseInt((null===(s=document.querySelector(".js-question"))||void 0===s?void 0:s.getAttribute("data-questionid"))||"0"),c=parseInt(e.getAttribute("data-post-id")||"0"),i=parseInt((null===(a=o.closest(".js-follow-up"))||void 0===a?void 0:a.getAttribute("data-follow-up-id"))||"0");t("follow_ups_ui_experiment.vote_attempt",{source:window.location.href,questionId:l,answerId:c,commentId:i,followUpsUIExperimentGroup:r})})):o.addEventListener("click",(t=>(async(t,e,o)=>{t.preventDefault();const n=e.getAttribute("data-post-id"),r=o.closest(".js-follow-up"),a=null==r?void 0:r.getAttribute("data-follow-up-id"),l=o.classList.contains("bc-orange-400")?0:2,c=new FormData;c.append("fkey",StackExchange.options.user.fkey),o.classList.add("is-loading");try{const t=await fetch(`${s}/posts/comments/${a}/vote/${l}`,{method:"POST",body:c});if(!t.ok)throw new Error;const e=await t.json();if(!e.Success)throw new Error(e.Message);const o=document.querySelector(`.js-follow-ups-container[data-post-id="${n}"]`);await u(o)}catch(t){o.classList.remove("is-loading");let e=__tr(["An error occurred during voting."], undefined, "en", []);t instanceof Error&&t.message&&(e=t.message),StackExchange.helpers.showToast(e,{type:"danger",useRawHtml:!0})}})(t,e,o)))}))};const w=t=>{t.querySelectorAll("button.js-follow-up-edit, button.js-edit-comment-cancel").forEach((t=>{const e=t.closest(".js-follow-up");e&&t.addEventListener("click",(()=>{t.classList.contains("js-follow-up-edit")&&(m(e,".edit-comment-form .js-comment-text-input",".edit-comment-form .js-char-counter",".js-edit-comment-submit"),async function(t){const e=t.querySelector(".edit-comment-form .js-comment-text-input"),o=t.getAttribute("data-follow-up-id"),n=await fetch(`${s}/get-text/follow-ups/${o}`),r=await n.text();e&&(e.value=r,e.dispatchEvent(new Event("input")))}(e)),a(e,[".js-toggle-for-edit",".edit-comment-form"]),e.querySelectorAll(".reply-to-comment-form").forEach((t=>{t.classList.contains("d-none")||t.classList.add("d-none")})),l(e.querySelector(".edit-comment-form"))}))}));t.querySelectorAll("button.js-edit-comment-submit").forEach((e=>{const o=e.closest(".js-follow-up");if(!o)return;const n=o.querySelector(".edit-comment-form .js-comment-text-input"),r=o.getAttribute("data-follow-up-id");e.addEventListener("click",(e=>i(e,t,r,n))),n.addEventListener("keydown",(e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),i(e,t,r,n))}))}))},h=t=>document.querySelector(`div[data-follow-up-id="${t}"]`),g=(t,e=!1)=>{t.classList.add("comment__highlight","pt6"),e&&t.scrollIntoView({behavior:"smooth",block:"center"})};function v(t,e){if(!e||""===e.trim())return t.value;return`@${function(t){const e=document.createElement("textarea");return e.innerHTML=t,e.value}(e)} `+t.value}const b=e=>{(null!=e?e:document.querySelectorAll(".js-follow-ups-container")).forEach((e=>{const o=e.querySelector(".js-bottom-bar");(e=>{e.querySelectorAll("button.js-reply-bar, button.js-add-comment-cancel").forEach((o=>{o.addEventListener("click",(()=>{var n;if(E()){const t=parseInt(e.getAttribute("data-post-id")||"0");document.dispatchEvent(new CustomEvent("firstTimeCommenting",{detail:{editorPosition:"top",postId:t}}))}else a(e,[".js-reply-bar",".add-comment-form"]),l(e.querySelector(".add-comment-form"));if(o.classList.contains("js-reply-bar")){const o=parseInt((null===(n=document.querySelector(".js-question"))||void 0===n?void 0:n.getAttribute("data-questionid"))||"0"),s=parseInt(e.getAttribute("data-post-id")||"0"),a=[...document.querySelectorAll(".js-follow-ups-container")].indexOf(e),l=parseInt(e.getAttribute("data-total-comment-count")||"0");t("follow_ups_ui_experiment.reply_bar_click",{source:window.location.href,followUpsUIExperimentGroup:r,questionId:o,answerId:s,answerPositionOnPage:a,numberOfPreExistingComments:l})}}))}))})(e),m(e,".js-comment-text-input",".js-char-counter",".js-add-comment-submit"),(t=>{const e=t.querySelector(".js-add-comment-submit"),o=t.querySelector(".js-comment-text-input");e&&o&&(e.addEventListener("click",(n=>{c(n,t,e,o,!0)})),o.addEventListener("keydown",(n=>{"Enter"!==n.key||n.shiftKey||(n.preventDefault(),c(n,t,e,o,!0))})))})(e),o&&(((t,e)=>{const o=t.querySelector(".js-add-comment-bottom-submit"),n=t.querySelector(".js-comment-text-input");o&&n&&(o.addEventListener("click",(t=>c(t,e,o,n,!1))),n.addEventListener("keydown",(t=>{"Enter"!==t.key||t.shiftKey||(t.preventDefault(),c(t,e,o,n,!1))})))})(o,e),function(e){const o=e.querySelector("button.js-add-comment-bottom-button"),n=e.querySelector("button.js-add-comment-bottom-cancel"),s=parseInt(e.closest(".js-follow-ups-container").getAttribute("data-post-id")||"0");o&&o.addEventListener("click",(()=>{var o;if(E())document.dispatchEvent(new CustomEvent("firstTimeCommenting",{detail:{editorPosition:"bottom",postId:s}}));else{const t=e.querySelector(".add-comment-bottom-form");(null==t?void 0:t.classList.contains("d-none"))&&(null==t||t.classList.remove("d-none")),l(e.querySelector(".add-comment-bottom-form"))}const n=parseInt((null===(o=document.querySelector(".js-question"))||void 0===o?void 0:o.getAttribute("data-questionid"))||"0"),a=[...document.querySelectorAll(".js-follow-ups-container")].indexOf(e),c=parseInt(e.getAttribute("data-total-comment-count")||"0");t("follow_ups_ui_experiment.add_comment_bottom_link_click",{source:window.location.href,followUpsUIExperimentGroup:r,questionId:n,answerId:s,answerPositionOnPage:a,numberOfPreExistingComments:c})})),n&&n.addEventListener("click",(()=>{const t=e.querySelector(".add-comment-bottom-form");(null==t?void 0:t.classList.contains("d-none"))||null==t||t.classList.add("d-none"),l(e.querySelector(".add-comment-bottom-form"))}))}(o),m(o,".js-comment-text-input",".js-char-counter",".js-add-comment-bottom-submit")),p(e),f(e),y(e),(t=>{const e=t.getAttribute("data-post-id"),o=t.getAttribute("data-comment-flags-remaining-today");t.querySelectorAll(".js-flag-button").forEach((t=>{const n=t.getAttribute("data-follow-up-id");t.addEventListener("click",(()=>{dispatchEvent(new CustomEvent("flagModalOpen",{detail:{postId:e,followUpId:n,commentFlagsRemainingToday:o}}))}))}))})(e),(t=>{const e=t.getAttribute("data-post-id");t.querySelectorAll(".js-flag-retract-button").forEach((t=>{const o=t.getAttribute("data-follow-up-id");t.addEventListener("click",(()=>{dispatchEvent(new CustomEvent("flagModalOpen",{detail:{postId:e,followUpId:o,retracting:!0}}))}))}))})(e),w(e),(t=>{const e=t.querySelectorAll(".js-follow-up-copy-link"),o=t.getAttribute("data-post-id");e.forEach((t=>{t.addEventListener("click",(async e=>{e.preventDefault();const n=t.closest(".js-follow-up"),r=null==n?void 0:n.getAttribute("data-follow-up-id"),s=`${window.location.origin}${window.location.pathname}#comment${r}_${o}`;try{await navigator.clipboard.writeText(s),StackExchange.helpers.showToast(__tr(["Link copied to clipboard!"], undefined, "en", []),{type:"success"})}catch{StackExchange.helpers.showToast(__tr(["Failed to copy link to clipboard."], undefined, "en", []),{type:"danger"})}}))}))})(e),(t=>{const e=t.querySelector(".js-full-collapse");e&&e.addEventListener("click",(()=>{t.querySelectorAll(".js-follow-ups, .js-arrow, .js-bottom-bar").forEach((t=>{t.classList.toggle("d-none")}))}))})(e),(t=>{const e=t.querySelector(".js-show-more-button");e&&e.addEventListener("click",(async()=>{await u(t,{topCommentsOnly:!1})}))})(e),(e=>{const o=e.querySelectorAll("button.js-follow-up-reply-to"),n=e.querySelectorAll("button.js-reply-to-comment-cancel");o.forEach((o=>{const n=o.closest(".js-follow-up");if(!n)return;const s=n.querySelector(".js-comment-text-input"),a=n.getAttribute("data-follow-up-id");o.addEventListener("click",(()=>{var o;if(E()){const t=parseInt(e.getAttribute("data-post-id")||"0");document.dispatchEvent(new CustomEvent("firstTimeCommenting",{detail:{followUpId:a,postId:t}}))}else{m(n,".reply-to-comment-form .js-comment-text-input",".reply-to-comment-form .js-char-counter",".js-reply-to-comment-submit"),n.querySelectorAll(".reply-to-comment-form").forEach((t=>{t.classList.contains("d-none")&&t.classList.remove("d-none")}));const t=n.querySelector(".reply-to-comment-form textarea");t&&t.focus()}const s=parseInt((null===(o=document.querySelector(".js-question"))||void 0===o?void 0:o.getAttribute("data-questionid"))||"0"),l=parseInt(e.getAttribute("data-post-id")||"0"),c=[...document.querySelectorAll(".js-follow-ups-container")].indexOf(e),i=parseInt(e.getAttribute("data-total-comment-count")||"0");t("follow_ups_ui_experiment.reply_button_click",{source:window.location.href,followUpsUIExperimentGroup:r,questionId:s,answerId:l,answerPositionOnPage:c,numberOfPreExistingComments:i})})),s.addEventListener("keydown",(t=>{"Enter"!==t.key||t.shiftKey||(t.preventDefault(),d(t,e,n,s,a))}))})),n.forEach((t=>{const e=t.closest(".js-follow-up");e&&t.addEventListener("click",(()=>{e.querySelectorAll(".reply-to-comment-form").forEach((t=>{t.classList.contains("d-none")||t.classList.add("d-none")})),l(e.querySelector(".reply-to-comment-form"))}))})),e.querySelectorAll("button.js-reply-to-comment-submit").forEach((t=>{const o=t.closest(".js-follow-up");if(!o)return;const n=o.querySelector(".js-comment-text-input"),r=o.getAttribute("data-follow-up-id");t.addEventListener("click",(t=>d(t,e,o,n,r)))}))})(e),(t=>{const e=t.closest(".js-answer");if(!e)return;const o=e.querySelector(".js-fetch-deleted-follow-ups");if(!o)return;const n=o.cloneNode(!0);o.replaceWith(n),n.addEventListener("click",(async e=>{e.preventDefault(),await u(t,{topCommentsOnly:!1,includeDeleted:!0})}),{once:!0})})(e)}))},E=()=>{var t;return"True"==(null===(t=document.querySelector(".js-follow-ups-container"))||void 0===t?void 0:t.getAttribute("data-show-first-time-commenting"))};b(),window.addEventListener("flagSubmitted",(async t=>{const{postId:e}=t.detail,o=document.querySelector(`.js-follow-ups-container[data-post-id="${e}"]`);await u(o)})),window.addEventListener("flagRetract",(async t=>{const{postId:e}=t.detail,o=document.querySelector(`.js-follow-ups-container[data-post-id="${e}"]`);await u(o)})),StackExchange.ready((()=>{document.querySelectorAll(".js-follow-ups-container").length>0&&(()=>{const t=window.location.hash;if(!t.startsWith("#comment"))return;const[e,o]=t.replace("#comment","").split("_");e&&o&&!isNaN(Number(e))&&!isNaN(Number(o))&&null===document.querySelector(`.js-question[data-questionid="${o}"]`)&&setTimeout((()=>{const t=h(e);if(t)return void g(t);const n=document.querySelector(`.js-follow-ups-container[data-post-id="${o}"]`);n?u(n,{topCommentsOnly:!1,includeDeleted:!0}).then((()=>{const t=h(e);t?g(t,!0):StackExchange.helpers.showToast(__tr(["Comment not found."], undefined, "en", []),{type:"danger"})})):StackExchange.helpers.showToast(__tr(["Comment not found."], undefined, "en", []),{type:"danger"})}),300)})(),E()&&(document.addEventListener("firstTimeCommenterValidationSuccess",(t=>{const e=t,o=document.querySelector(`#follow-ups-container-${e.detail.postId}`);if(o&&"top"===e.detail.editorPosition&&(a(o,[".js-reply-bar",".add-comment-form"]),l(o.querySelector(".add-comment-form"))),o&&"bottom"===e.detail.editorPosition){const t=o.querySelector(".add-comment-bottom-form");(null==t?void 0:t.classList.contains("d-none"))&&(null==t||t.classList.remove("d-none")),l(o.querySelector(".add-comment-bottom-form"))}const n=document.querySelector(`#comment-${e.detail.followUpId}`);if(n){const t=n.querySelector(".reply-to-comment-form");t&&t.classList.contains("d-none")&&t.classList.remove("d-none");const e=n.querySelector(".reply-to-comment-form textarea");e&&e.focus()}document.querySelectorAll(".js-follow-ups-container").forEach((t=>{t.setAttribute("data-show-first-time-commenting","False")}))})),document.addEventListener("firstTimeCommenterValidationFailed",(()=>{document.querySelectorAll(".js-follow-up-reply-to, .js-reply-bar, .js-add-comment-bottom-button").forEach((t=>{t.setAttribute("disabled","true")}))})))}))})()})();